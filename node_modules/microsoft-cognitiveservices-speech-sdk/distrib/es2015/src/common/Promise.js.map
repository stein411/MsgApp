{"version":3,"sources":["src/common/Promise.ts"],"names":[],"mappings":"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","file":"Promise.js","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved.\r\n// Licensed under the MIT license.\r\n\r\nimport { ArgumentNullError  } from \"./Error\";\r\n\r\nexport enum PromiseState {\r\n    None,\r\n    Resolved,\r\n    Rejected,\r\n}\r\n\r\nexport interface IPromise<T> {\r\n    result(): PromiseResult<T>;\r\n\r\n    continueWith<TContinuationResult>(\r\n        continuationCallback: (promiseResult: PromiseResult<T>) => TContinuationResult): IPromise<TContinuationResult>;\r\n\r\n    continueWithPromise<TContinuationResult>(\r\n        continuationCallback: (promiseResult: PromiseResult<T>) => IPromise<TContinuationResult>): IPromise<TContinuationResult>;\r\n\r\n    onSuccessContinueWith<TContinuationResult>(\r\n        continuationCallback: (result: T) => TContinuationResult): IPromise<TContinuationResult>;\r\n\r\n    onSuccessContinueWithPromise<TContinuationResult>(\r\n        continuationCallback: (result: T) => IPromise<TContinuationResult>): IPromise<TContinuationResult>;\r\n\r\n    on(successCallback: (result: T) => void, errorCallback: (error: string) => void): IPromise<T>;\r\n\r\n    finally(callback: () => void): IPromise<T>;\r\n}\r\n\r\nexport interface IDeferred<T> {\r\n    state(): PromiseState;\r\n\r\n    promise(): IPromise<T>;\r\n\r\n    resolve(result: T): IDeferred<T>;\r\n\r\n    reject(error: string): IDeferred<T>;\r\n}\r\n\r\nexport class PromiseResult<T> {\r\n    protected privIsCompleted: boolean;\r\n    protected privIsError: boolean;\r\n    protected privError: string;\r\n    protected privResult: T;\r\n\r\n    public constructor(promiseResultEventSource: PromiseResultEventSource<T>) {\r\n        promiseResultEventSource.on((result: T) => {\r\n            if (!this.privIsCompleted) {\r\n                this.privIsCompleted = true;\r\n                this.privIsError = false;\r\n                this.privResult = result;\r\n            }\r\n        }, (error: string) => {\r\n            if (!this.privIsCompleted) {\r\n                this.privIsCompleted = true;\r\n                this.privIsError = true;\r\n                this.privError = error;\r\n            }\r\n        });\r\n    }\r\n\r\n    public get isCompleted(): boolean {\r\n        return this.privIsCompleted;\r\n    }\r\n\r\n    public get isError(): boolean {\r\n        return this.privIsError;\r\n    }\r\n\r\n    public get error(): string {\r\n        return this.privError;\r\n    }\r\n\r\n    public get result(): T {\r\n        return this.privResult;\r\n    }\r\n\r\n    public throwIfError = (): void => {\r\n        if (this.isError) {\r\n            throw this.error;\r\n        }\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class PromiseResultEventSource<T>  {\r\n\r\n    private privOnSetResult: (result: T) => void;\r\n    private privOnSetError: (error: string) => void;\r\n\r\n    public setResult = (result: T): void => {\r\n        this.privOnSetResult(result);\r\n    }\r\n\r\n    public setError = (error: string): void => {\r\n        this.privOnSetError(error);\r\n    }\r\n\r\n    public on = (onSetResult: (result: T) => void, onSetError: (error: string) => void): void => {\r\n        this.privOnSetResult = onSetResult;\r\n        this.privOnSetError = onSetError;\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class PromiseHelper {\r\n    public static whenAll = (promises: Array<Promise<any>>): Promise<boolean> => {\r\n        if (!promises || promises.length === 0) {\r\n            throw new ArgumentNullError(\"promises\");\r\n        }\r\n\r\n        const deferred = new Deferred<boolean>();\r\n        const errors: string[] = [];\r\n        let completedPromises: number = 0;\r\n\r\n        const checkForCompletion = () => {\r\n            completedPromises++;\r\n            if (completedPromises === promises.length) {\r\n                if (errors.length === 0) {\r\n                    deferred.resolve(true);\r\n                } else {\r\n                    deferred.reject(errors.join(\", \"));\r\n                }\r\n            }\r\n        };\r\n\r\n        for (const promise of promises) {\r\n            promise.on((r: any) => {\r\n                checkForCompletion();\r\n            }, (e: string) => {\r\n                errors.push(e);\r\n                checkForCompletion();\r\n            });\r\n        }\r\n\r\n        return deferred.promise();\r\n    }\r\n\r\n    public static fromResult = <TResult>(result: TResult): Promise<TResult> => {\r\n        const deferred = new Deferred<TResult>();\r\n        deferred.resolve(result);\r\n        return deferred.promise();\r\n    }\r\n\r\n    public static fromError = <TResult>(error: string): Promise<TResult> => {\r\n        const deferred = new Deferred<TResult>();\r\n        deferred.reject(error);\r\n        return deferred.promise();\r\n    }\r\n}\r\n\r\n// TODO: replace with ES6 promises\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class Promise<T> implements IPromise<T> {\r\n    private privSink: Sink<T>;\r\n\r\n    public constructor(sink: Sink<T>) {\r\n        this.privSink = sink;\r\n    }\r\n\r\n    public result = (): PromiseResult<T> => {\r\n        return this.privSink.result;\r\n    }\r\n\r\n    public continueWith = <TContinuationResult>(\r\n        continuationCallback: (promiseResult: PromiseResult<T>) => TContinuationResult): Promise<TContinuationResult> => {\r\n\r\n        if (!continuationCallback) {\r\n            throw new ArgumentNullError(\"continuationCallback\");\r\n        }\r\n\r\n        const continuationDeferral = new Deferred<TContinuationResult>();\r\n\r\n        this.privSink.on(\r\n            (r: T) => {\r\n                try {\r\n                    const continuationResult: TContinuationResult = continuationCallback(this.privSink.result);\r\n                    continuationDeferral.resolve(continuationResult);\r\n                } catch (e) {\r\n                    continuationDeferral.reject(e);\r\n                }\r\n            },\r\n            (error: string) => {\r\n                try {\r\n                    const continuationResult: TContinuationResult = continuationCallback(this.privSink.result);\r\n                    continuationDeferral.resolve(continuationResult);\r\n                } catch (e) {\r\n                    continuationDeferral.reject(`'Error handler for error ${error} threw error ${e}'`);\r\n                }\r\n            },\r\n        );\r\n\r\n        return continuationDeferral.promise();\r\n    }\r\n\r\n    public onSuccessContinueWith = <TContinuationResult>(\r\n        continuationCallback: (result: T) => TContinuationResult): Promise<TContinuationResult> => {\r\n\r\n        if (!continuationCallback) {\r\n            throw new ArgumentNullError(\"continuationCallback\");\r\n        }\r\n\r\n        const continuationDeferral = new Deferred<TContinuationResult>();\r\n\r\n        this.privSink.on(\r\n            (r: T) => {\r\n                try {\r\n                    const continuationResult: TContinuationResult = continuationCallback(r);\r\n                    continuationDeferral.resolve(continuationResult);\r\n                } catch (e) {\r\n                    continuationDeferral.reject(e);\r\n                }\r\n            },\r\n            (error: string) => {\r\n                continuationDeferral.reject(error);\r\n            },\r\n        );\r\n\r\n        return continuationDeferral.promise();\r\n    }\r\n\r\n    public continueWithPromise = <TContinuationResult>(\r\n        continuationCallback: (promiseResult: PromiseResult<T>) => Promise<TContinuationResult>): Promise<TContinuationResult> => {\r\n\r\n        if (!continuationCallback) {\r\n            throw new ArgumentNullError(\"continuationCallback\");\r\n        }\r\n\r\n        const continuationDeferral = new Deferred<TContinuationResult>();\r\n\r\n        this.privSink.on(\r\n            (r: T) => {\r\n                try {\r\n                    const continuationPromise: Promise<TContinuationResult> = continuationCallback(this.privSink.result);\r\n                    if (!continuationPromise) {\r\n                        throw new Error(\"'Continuation callback did not return promise'\");\r\n                    }\r\n                    continuationPromise.on((continuationResult: TContinuationResult) => {\r\n                        continuationDeferral.resolve(continuationResult);\r\n                    }, (e: string) => {\r\n                        continuationDeferral.reject(e);\r\n                    });\r\n                } catch (e) {\r\n                    continuationDeferral.reject(e);\r\n                }\r\n            },\r\n            (error: string) => {\r\n                try {\r\n                    const continuationPromise: Promise<TContinuationResult> = continuationCallback(this.privSink.result);\r\n                    if (!continuationPromise) {\r\n                        throw new Error(\"Continuation callback did not return promise\");\r\n                    }\r\n                    continuationPromise.on((continuationResult: TContinuationResult) => {\r\n                        continuationDeferral.resolve(continuationResult);\r\n                    }, (e: string) => {\r\n                        continuationDeferral.reject(e);\r\n                    });\r\n                } catch (e) {\r\n                    continuationDeferral.reject(`'Error handler for error ${error} threw error ${e}'`);\r\n                }\r\n            },\r\n        );\r\n\r\n        return continuationDeferral.promise();\r\n    }\r\n\r\n    public onSuccessContinueWithPromise = <TContinuationResult>(\r\n        continuationCallback: (result: T) => Promise<TContinuationResult>): Promise<TContinuationResult> => {\r\n\r\n        if (!continuationCallback) {\r\n            throw new ArgumentNullError(\"continuationCallback\");\r\n        }\r\n\r\n        const continuationDeferral = new Deferred<TContinuationResult>();\r\n\r\n        this.privSink.on(\r\n            (r: T) => {\r\n                try {\r\n                    const continuationPromise: Promise<TContinuationResult> = continuationCallback(r);\r\n                    if (!continuationPromise) {\r\n                        throw new Error(\"Continuation callback did not return promise\");\r\n                    }\r\n                    continuationPromise.on((continuationResult: TContinuationResult) => {\r\n                        continuationDeferral.resolve(continuationResult);\r\n                    }, (e: string) => {\r\n                        continuationDeferral.reject(e);\r\n                    });\r\n                } catch (e) {\r\n                    continuationDeferral.reject(e);\r\n                }\r\n            },\r\n            (error: string) => {\r\n                continuationDeferral.reject(error);\r\n            },\r\n        );\r\n\r\n        return continuationDeferral.promise();\r\n    }\r\n\r\n    public on = (\r\n        successCallback: (result: T) => void,\r\n        errorCallback: (error: string) => void): Promise<T> => {\r\n        if (!successCallback) {\r\n            throw new ArgumentNullError(\"successCallback\");\r\n        }\r\n\r\n        if (!errorCallback) {\r\n            throw new ArgumentNullError(\"errorCallback\");\r\n        }\r\n\r\n        this.privSink.on(successCallback, errorCallback);\r\n        return this;\r\n    }\r\n\r\n    public finally = (callback: () => void): Promise<T> => {\r\n        if (!callback) {\r\n            throw new ArgumentNullError(\"callback\");\r\n        }\r\n\r\n        const callbackWrapper = (_: any) => {\r\n            callback();\r\n        };\r\n\r\n        return this.on(callbackWrapper, callbackWrapper);\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class Deferred<T> implements IDeferred<T> {\r\n    private privPromise: Promise<T>;\r\n    private privSink: Sink<T>;\r\n\r\n    public constructor() {\r\n        this.privSink = new Sink<T>();\r\n        this.privPromise = new Promise<T>(this.privSink);\r\n    }\r\n\r\n    public state = (): PromiseState => {\r\n        return this.privSink.state;\r\n    }\r\n\r\n    public promise = (): Promise<T> => {\r\n        return this.privPromise;\r\n    }\r\n\r\n    public resolve = (result: T): Deferred<T> => {\r\n        this.privSink.resolve(result);\r\n        return this;\r\n    }\r\n\r\n    public reject = (error: string): Deferred<T> => {\r\n        this.privSink.reject(error);\r\n        return this;\r\n    }\r\n}\r\n\r\n// tslint:disable-next-line:max-classes-per-file\r\nexport class Sink<T> {\r\n    private privState: PromiseState = PromiseState.None;\r\n    private privPromiseResult: PromiseResult<T> = null;\r\n    private privPromiseResultEvents: PromiseResultEventSource<T> = null;\r\n\r\n    private privSuccessHandlers: Array<((result: T) => void)> = [];\r\n    private privErrorHandlers: Array<(e: string) => void> = [];\r\n\r\n    public constructor() {\r\n        this.privPromiseResultEvents = new PromiseResultEventSource();\r\n        this.privPromiseResult = new PromiseResult(this.privPromiseResultEvents);\r\n    }\r\n\r\n    public get state(): PromiseState {\r\n        return this.privState;\r\n    }\r\n\r\n    public get result(): PromiseResult<T> {\r\n        return this.privPromiseResult;\r\n    }\r\n\r\n    public resolve = (result: T): void => {\r\n        if (this.privState !== PromiseState.None) {\r\n            throw new Error(\"'Cannot resolve a completed promise'\");\r\n        }\r\n\r\n        this.privState = PromiseState.Resolved;\r\n        this.privPromiseResultEvents.setResult(result);\r\n\r\n        for (let i = 0; i < this.privSuccessHandlers.length; i++) {\r\n            this.executeSuccessCallback(result, this.privSuccessHandlers[i], this.privErrorHandlers[i]);\r\n        }\r\n\r\n        this.detachHandlers();\r\n    }\r\n\r\n    public reject = (error: string): void => {\r\n        if (this.privState !== PromiseState.None) {\r\n            throw new Error(\"'Cannot reject a completed promise'\");\r\n        }\r\n\r\n        this.privState = PromiseState.Rejected;\r\n        this.privPromiseResultEvents.setError(error);\r\n\r\n        for (const errorHandler of this.privErrorHandlers) {\r\n            this.executeErrorCallback(error, errorHandler);\r\n        }\r\n\r\n        this.detachHandlers();\r\n    }\r\n\r\n    public on = (\r\n        successCallback: (result: T) => void,\r\n        errorCallback: (error: string) => void): void => {\r\n\r\n        if (successCallback == null) {\r\n            successCallback = (r: T) => { return; };\r\n        }\r\n\r\n        if (this.privState === PromiseState.None) {\r\n            this.privSuccessHandlers.push(successCallback);\r\n            this.privErrorHandlers.push(errorCallback);\r\n        } else {\r\n            if (this.privState === PromiseState.Resolved) {\r\n                this.executeSuccessCallback(this.privPromiseResult.result, successCallback, errorCallback);\r\n            } else if (this.privState === PromiseState.Rejected) {\r\n                this.executeErrorCallback(this.privPromiseResult.error, errorCallback);\r\n            }\r\n\r\n            this.detachHandlers();\r\n        }\r\n    }\r\n\r\n    private executeSuccessCallback = (result: T, successCallback: (result: T) => void, errorCallback: (error: string) => void): void => {\r\n        try {\r\n            successCallback(result);\r\n        } catch (e) {\r\n            this.executeErrorCallback(`'Unhandled callback error: ${e}'`, errorCallback);\r\n        }\r\n    }\r\n\r\n    private executeErrorCallback = (error: string, errorCallback: (error: string) => void): void => {\r\n        if (errorCallback) {\r\n            try {\r\n                errorCallback(error);\r\n            } catch (e) {\r\n                throw new Error(`'Unhandled callback error: ${e}. InnerError: ${error}'`);\r\n            }\r\n        } else {\r\n            throw new Error(`'Unhandled error: ${error}'`);\r\n        }\r\n    }\r\n\r\n    private detachHandlers = (): void => {\r\n        this.privErrorHandlers = [];\r\n        this.privSuccessHandlers = [];\r\n    }\r\n}\r\n"]}